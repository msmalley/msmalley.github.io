<!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
        <title>Pandora | Blockatars</title>
        <style>
            canvas {
                width: 600px !important;
                height: 600px !important;
            }
        </style>
    </head>
    <body>

        <script>

        // XOR
        function XS(x, y, z, w)
        {
            this.x = (x ? x >>> 0 : 123456789);
            this.y = (y ? y >>> 0 : 362436069);
            this.z = (z ? z >>> 0 : 521288629);
            this.w = (w ? w >>> 0 : 88675123);
        }

        XS.prototype.next = function XS_next()
        {
            var t = this.x ^ (this.x << 11) & 0x7FFFFFFF;
            this.x = this.y;
            this.y = this.z;
            this.z = this.w;
            this.w = (this.w ^ (this.w >> 19)) ^ (t ^ (t >> 8));
            return this.w;
        };

        XS.prototype.unit = function XS_unit()
        {
            return this.next() / 0x80000000;
        };

        XS.prototype.unitInclusive = function XS_unitInclusive()
        {
            return this.next() / 0x7FFFFFFF;
        };

        XS.prototype.integer = function XS_integer(min, max)
        {
            return this.integerExclusive(min, max + 1);
        };

        XS.prototype.integerExclusive = function XS_integerExclusive(min, max)
        {
            min = Math.floor(min);
            max = Math.floor(max);
            return Math.floor(this.unit() * (max - min)) + min;
        };

        XS.prototype.real = function XS_real(min, max)
        {
            return this.unit() * (max - min) + min;
        };

        XS.prototype.realInclusive = function XS_realInclusive(min, max)
        {
            return this.unitInclusive() * (max - min) + min;
        };

        XS.prototype.reseed = function XS_reseed(x, y, z, w)
        {
            this.x = (x ? x >>> 0 : 123456789);
            this.y = (y ? y >>> 0 : 362436069);
            this.z = (z ? z >>> 0 : 521288629);
            this.w = (w ? w >>> 0 : 88675123);
        };
            
        // UTILS
        var s2s = function(str)
        {
            var num = '';
            for(x = 0; x < str.length; x++)
            {
                var c = str.charAt(x);
                var n = c.charCodeAt(0);
                num+= n;
            }
            return parseInt(num);
        }
        var gc = function(s)
        {
            var h = ['A', 'B', 'C', 'D', 'E', 'F', '0', '1', '2', '3', '4', '5', '6', '7', '8', '9'];
            var r1 = new XS(parseInt(s2s('R') * s));
            var r2 = new XS(parseInt(s2s('G') * s));
            var r3 = new XS(parseInt(s2s('B') * s));
            var r4 = new XS(parseInt(s2s('C') * s));
            var r5 = new XS(parseInt(s2s('M') * s));
            var r6 = new XS(parseInt(s2s('Y') * s));
            var c = h[r1.integer(0, (h.length - 1))];
            c+= h[r2.integer(0, (h.length - 1))];
            c+= h[r3.integer(0, (h.length - 1))];
            c+= h[r4.integer(0, (h.length - 1))];
            c+= h[r5.integer(0, (h.length - 1))];
            c+= h[r6.integer(0, (h.length - 1))];
            return '#' + c;
        }

        // General Config
        var n = '' + (new Date().getTime() * 123456789) + '';
        var nft = n.substring(0, 16);
        // To be done on-chain ...
        var head_nft = parseInt('1' + nft);
        var leye_nft = parseInt('1' + nft);
        var reye_nft = parseInt('1' + nft);
        var mouth_nft = parseInt('1' + nft);
        var nose_nft = parseInt('1' + nft);

        // Setup Canvas
        var div = document.createElement("DIV");
        var can = document.createElement("CANVAS");
        var ctx = can.getContext('2d');
        can.id = 'pandora-square-' + nft;
        div.id = "pandora-wrapper-" + nft;
        div.classList.add("pandora-square");
        document.body.appendChild(div);
        var wrapper = document.querySelector('#pandora-wrapper-' + nft);
        wrapper.appendChild(can);
        var size = 300;
        var dpr = 2;
        can.width = size * dpr;
        can.height = size * dpr;
        ctx.scale(dpr, dpr);
            
        // BLOCKATARS
            
        var build_head = function(id)
        {
            avatar_layer('head', id);
        }
        var build_leye = function(id)
        {
            avatar_layer('leye', id);
        }
        var build_reye = function(id)
        {
            avatar_layer('reye', id);
        }
        var build_mouth = function(id)
        {
            avatar_layer('mouth', id);
        }
        var build_nose = function(id)
        {
            avatar_layer('nose', id);
        }
            
        var build_avatar = function(
            head_id,
            leye_id,
            reye_id,
            mouth_id,
            nose_id
        )
        {
            build_head(head_id);
            build_leye(leye_id);
            build_reye(reye_id);
            build_mouth(mouth_id);
            build_nose(nose_id);
        }
        
        var got_glasses = false;
        
        var avatar_layer = function(layer, nft)
        {   
            var s1 = parseInt(nft * s2s('R'));
            var s2 = parseInt(nft * s2s('G'));
            var s3 = parseInt(nft * s2s('B'));
            var r1 = new XS(s1);
            var r2 = new XS(s2);
            var r3 = new XS(s3);
            var r4 = new XS(s1 + s2);
            var r5 = new XS(s2 + s3);
            var r6 = new XS(s1 + s3);
            var colors = [
                gc(s1),
                gc(s2), 
                gc(s3),
                gc(s1 + s2),
                gc(s2 + s3)
            ];
            var white = colors[0];
            
            var bac = {
                ghead: false,
                geyes: false,
                gnose: false,
                gmouth: false,
                glasses: false,
                teeth: false,
                eyes: 'square',
                pupils: 'square',
                lashes: 'square',
                nose: 'square',
                mouth: 'square'
            };
            
            if(r1.integer(0, 1)) bac.ghead = true;
            if(r2.integer(0, 1)) bac.geyes = true;
            if(r3.integer(0, 1)) bac.gnose = true;
            if(r4.integer(0, 1)) bac.gmouth = true;
            if(r5.integer(0, 1)) bac.glasses = true;
            if(r6.integer(0, 1)) bac.teeth = true;
            
            if(r1.integer(2, 4) + r2.integer(0, 3) > 5) bac.eyes = 'round';
            if(r3.integer(2, 4) + r4.integer(0, 3) > 5) bac.pupils = 'round';
            if(r5.integer(2, 4) + r6.integer(0, 3) > 5) bac.lashes = 'round';
            if(r1.integer(2, 4) + r6.integer(0, 3) > 5) bac.nose = 'round';
            if(r2.integer(2, 4) + r5.integer(0, 3) > 5) bac.mouth = 'round';
            
            var a1 = parseFloat('0.' + r1.integer(25, 95));
            var a2 = parseFloat('0.' + r2.integer(25, 95));
            var a3 = parseFloat('0.' + r3.integer(25, 95));
            var a4 = parseFloat('0.' + r4.integer(25, 95));
            var a5 = parseFloat('0.' + r5.integer(25, 95));
            var a6 = parseFloat('0.' + r6.integer(25, 95));
            
            console.log('bac', bac);
            
            var square = function(x, y, w, h, fill = false, stroke = false, line = 0)
            {
                ctx.beginPath();
                ctx.rect(x, y, w, h);
                ctx.lineWidth = 0;
                if(line) ctx.lineWidth = line;
                if(fill)
                {
                    ctx.fillStyle = fill;
                    ctx.fill();
                }
                if(stroke)
                {
                    ctx.strokeStyle = stroke;
                    ctx.stroke();
                }
            }
            
            var circle = function(x, y, w, r = 2, fill = false, stroke = false, line = 0, flip = false)
            {
                ctx.beginPath();
                if(flip)
                {
                    ctx.arc(x + (w/2), y + (w/2), w/2, r*Math.PI, 0);
                }
                else
                {
                    ctx.arc(x + (w/2), y + (w/2), w/2, 0, r*Math.PI);
                }
                ctx.lineWidth = 0;
                if(line) ctx.lineWidth = line;
                if(fill)
                {
                    ctx.fillStyle = fill;
                    ctx.fill();
                }
                if(stroke)
                {
                    ctx.strokeStyle = stroke;
                    ctx.stroke();
                }
            }
            
            var grad = function(x = 0, y = 0, w = 0, h = 0, d = 1, cx1 = false, cx2 = false)
            {
                var direction = d;
                var grd = ctx.createLinearGradient(x,y,x,h);
                if(direction == 2) grd = ctx.createLinearGradient(x,y,w,h);
                if(direction == 3) grd = ctx.createLinearGradient(x,h,w,x);
                if(direction == 4) grd = ctx.createRadialGradient((can.width/2)/2,(can.height/2)/2,0,can.width/2,can.height/2,can.width);
                var c1 = colors[r2.integer(0, colors.length - 1)];
                var c2 = colors[r4.integer(0, colors.length - 1)];
                if(!cx1 || !cx2)
                {
                    grd.addColorStop(0,c1);
                    grd.addColorStop(1,c2);
                }
                else
                {
                    grd.addColorStop(0,cx1);
                    grd.addColorStop(1,cx2);
                }
                return grd;
            }
            
            var lashes = function(x, y, w)
            {
                y = y - r3.integer(1, 10);
                var lw = r4.integer(0, 4);
                
                ctx.beginPath();
                ctx.strokeStyle = colors[2];
                ctx.lineCap = bac.lashes;

                ctx.lineWidth = lw;

                if(r6.integer(0, 1) && r5.integer(0, 1))
                {
                    ctx.moveTo(x, y - (10 + lw));
                    ctx.lineTo(x + w, y - (10 + lw));
                }
                else
                {
                    var va1 = -5 + r5.integer(0, 10);
                    var va2 = -5 + r6.integer(0, 10);
                    ctx.moveTo(x, y - (10 + lw + va1));
                    ctx.lineTo(x + w, y - (10 + lw + va2));
                }
                ctx.stroke();
            }
            
            var avatar = function()
            {
                var fill = white;
                if(bac.ghead)
                {
                    var x1 = r1.integer(1, 4);
                    var c1 = colors[r2.integer(0, colors.length - 1)];
                    fill = grad(0, 0, can.width, can.height, x1, white, c1);
                }
                
                // Background ...
                if(layer == 'head')
                {
                    square(0, 0, can.width, can.height, fill);

                    if(bac.ghead)
                    {
                        ctx.globalAlpha = a4;
                        square(0, 0, can.width, can.height, white);
                        ctx.globalAlpha = 1;
                    }
                }
                
                // EYES
                var eh = r1.integer(60, 110);
                var ma = r2.integer(25, 35);
                var ex = 110 - eh;
                var lx = ma + (ex - (ex/10));
                var ly = ma + (lx / 3);
                var nosex = ly + eh;
                ctx.globalAlpha = a6;
                
                var vx = -5 + r3.integer(0, 10);
                var vy = -5 + r4.integer(0, 10);

                fill = colors[1];

                var line = 0;
                var mline = 0;
                var nline = 0;
                var stroke = false;
                var mstroke = false;
                var nstroke = false;
                if(r1.integer(0, 1) || r6.integer(0, 1)) line = r4.integer(1, 10);
                if(r2.integer(0, 1) || r4.integer(0, 1)) mline = r2.integer(1, 5);
                if(r3.integer(0, 1) || r5.integer(0, 1)) nline = r6.integer(1, 3);
                if(line > 0) stroke = colors[2];
                if(mline > 0) mstroke = colors[3];
                if(nline > 0) nstroke = colors[4];
                
                if(bac.geyes)
                {
                    var x2 = r2.integer(1, 4);
                    var c3 = colors[r3.integer(0, colors.length - 1)];
                    fill = grad(0, 0, can.width, can.height, x2, colors[1], c3);
                }
                
                var a33 = 0.33;
                var a66 = 0.66;

                if(layer == 'head' && bac.glasses)
                { 
                    var gh = (eh / 20) * r6.integer(1, 10);
                    square(0 - line, (ly + (eh/2)) - (gh/2), can.width + (line*2), gh, fill, stroke, line);
                    got_glasses = true;
                }
                
                if(got_glasses && (layer == 'leye' || layer == 'reye'))
                {
                    a6 = 1; a33 = 1; a66 = 1;
                    fill = white;
                }
                
                ctx.globalAlpha = a6;
                
                var pfill = colors[3];
                var ph = eh / r1.integer(3, 9);
                
                if(layer == 'leye')
                {
                    // Left eye ...
                    if(bac.eyes == 'square')
                    {
                        ctx.globalAlpha = a33;
                        square(lx + 10, ly + 10, eh - 20, eh - 20, stroke, false);
                        ctx.globalAlpha = a6;
                        square(lx, ly, eh, eh, fill, stroke, line);
                        if(bac.geyes)
                        {
                            ctx.globalAlpha = a66;
                            square(lx, ly, eh, eh, colors[1], stroke, line);
                            ctx.globalAlpha = a6;
                        }
                    }
                    else
                    {
                        circle(lx, ly, eh, 2, fill, stroke, line);
                        if(bac.geyes)
                        {
                            ctx.globalAlpha = a66;
                            circle(lx, ly, eh, 2, colors[1], stroke, line);
                            ctx.globalAlpha = a6;
                        }
                    }

                    lashes(lx, ly, eh);
                    nosex = nosex + ly + eh;
                }

                if(layer == 'head' && bac.glasses || got_glasses)
                {
                    ph = ((ph / 100) * r3.integer(10, 50)) + ph;
                }

                var pX = (lx + (eh/2)) - (ph/2);
                var pY = (ly + (eh/2)) - (ph/2);
                var vx1 = ((ph / 2) / 1.5);
                var xx = (0 - vx1) + r5.integer(0, (vx1 * 2));
                var yy = (0 - vx1) + r4.integer(0, (vx1 * 2));
                
                if(layer == 'leye')
                {
                    if(bac.pupils == 'square')
                    {
                        square(pX + xx, pY + yy, ph, ph, pfill, false, line);
                    }
                    else
                    {
                        circle(pX + xx, pY + yy, ph, 2, pfill, false, line);
                    }
                }
                
                if(got_glasses && (layer == 'leye' || layer == 'reye'))
                {
                    a6 = 1; a33 = 1; a66 = 1;
                    fill = white;
                }
                
                if(layer == 'reye')
                {
                    // Right eye ...
                    var newX = (can.width / 2) - (eh + lx);
                    if(layer == 'head' && bac.glasses || got_glasses)
                    {
                        vy = 0;
                        vx = 0;
                    }
                    if(bac.eyes == 'square')
                    {
                        ctx.globalAlpha = a33;
                        square(newX + 10, (ly + vy) + 10, (eh + vx) - 20, (eh + vx) - 20, stroke, false);
                        ctx.globalAlpha = a6;
                        square(newX, ly + vy, eh + vx, eh + vx, fill, stroke, line);
                        if(bac.geyes)
                        {
                            ctx.globalAlpha = a66;
                            square(newX, ly + vy, eh + vx, eh + vx, colors[1], stroke, line);
                            ctx.globalAlpha = a6;
                        }
                    }
                    else
                    {
                        circle(newX, ly + vy, eh + vx, 2, fill, stroke, line);
                        if(bac.geyes)
                        {
                            ctx.globalAlpha = 0.66;
                            circle(newX, ly + vy, eh + vx, 2, colors[1], stroke, line);
                            ctx.globalAlpha = a6;
                        }
                    }

                    lashes(newX, ly + vy, eh + vx);

                    var pX = (newX + ((eh+vx) / 2)) - (ph/2);
                    var pY = ((ly + vy) + ((eh+vx) / 2)) - (ph/2);

                    var xx2 = (0 - vx1) + r3.integer(0, (vx1 * 2));
                    var yy2 = (0 - vx1) + r2.integer(0, (vx1 * 2));
                    if(r6.integer(66, 67) > 66)
                    {
                        xx2 = xx;
                        yy2 = yy;
                    }

                    if(bac.pupils == 'square')
                    {
                        square(pX + xx2, pY + yy2, ph, ph, pfill, false, line);
                    }
                    else
                    {
                        circle(pX + xx2, pY + yy2, ph, 2, pfill, false, line);
                    }
                }
                
                // Mouth
                var my = (((can.height/2)/2))+lx;
                var vxm = -10 + r1.integer(0, 20);
                var nose_location = nosex + ma;
                var mouth_location = my + vxm;
                
                if(layer == 'mouth')
                {
                    ctx.globalAlpha = a1;
                    var vym = -10 + r2.integer(0, 20);
                    var mh = (eh / 2) + vym;
                    var mw = (eh * 2) + vxm;

                    if(bac.mouth == 'round')
                    {
                        mw = eh + vxm;
                    }

                    var mx = ((can.width/2) - mw)/2;
                    var mfill = colors[1];

                    if(bac.gmouth)
                    {
                        var x3 = r3.integer(1, 4);
                        var c4 = colors[r4.integer(0, colors.length - 1)];
                        mfill = grad(0, 0, can.width, can.height, x2, colors[1], c4);
                    }

                    if(bac.mouth == 'square')
                    {
                        if(bac.teeth)
                        {
                            var sx = mx + vym;
                            var sy = my + vxm;
                            square(sx - 10, sy - 10, mw + 20, mh + 20, mfill, mstroke, mline);
                            square(sx, sy, mw, mh, mfill, mstroke, mline);
                            var t = r1.integer(2, 6);
                            var tw = mw / t;
                            var rar = false;
                            var xrar = false;
                            if(r1.integer(0, 1) && r6.integer(0, 1)) 
                            {
                                rar = true;
                            }
                            if(r2.integer(0, 1) || r5.integer(0, 1)) 
                            {
                                xrar = true
                            }
                            if(rar || xrar)
                            {
                                for(i = 0; i < t; i++)
                                {
                                    if(i % 2 == 0) 
                                    {
                                        if(xrar)
                                        {
                                            ctx.moveTo(
                                                sx + (i*tw), 
                                                sy
                                            );
                                            ctx.lineTo(
                                                sx + ((i+1)*tw), 
                                                sy + mh
                                            );
                                        }
                                        else
                                        {
                                            ctx.moveTo(
                                                sx + (i*tw), 
                                                sy + mh
                                            );
                                            ctx.lineTo(
                                                sx + ((i+1)*tw), 
                                                sy
                                            );
                                        }
                                    }
                                    else
                                    {
                                        if(rar)
                                        {
                                            ctx.moveTo(
                                                sx + (i*tw), 
                                                sy + mh
                                            );
                                            ctx.lineTo(
                                                sx + ((i+1)*tw), 
                                                sy
                                            );
                                        }
                                        else
                                        {
                                            ctx.moveTo(
                                                sx + (i*tw), 
                                                sy
                                            );
                                            ctx.lineTo(
                                                sx + ((i+1)*tw), 
                                                sy + mh
                                            );
                                        }
                                    }
                                    ctx.lineWidth = mline;
                                    ctx.strokeStyle = mstroke;
                                    ctx.stroke();
                                } 
                            }
                            else
                            {
                                for(i = 0; i < t; i++)
                                {
                                    ctx.globalAlpha = 0.5;
                                    square((mx + vym) + (tw * i), my + vxm, tw, mh / 2, white, mstroke, mline);
                                    ctx.globalAlpha = 0.75;
                                    square((mx + vym) + (tw * i), (my + vxm) + (mh/2), tw, mh / 2, white, mstroke, mline);
                                }
                            }
                            
                            ctx.globalAlpha = a1;
                        }
                        else
                        {
                            ctx.globalAlpha = 0.5;
                            square((mx + vym) - 10, (my + vxm) - 10, mw + 20, mh + 20, mfill, mstroke, mline);
                            ctx.globalAlpha = a1;
                            square(mx + vym, my + vxm, mw, mh, mfill, mstroke, mline);
                        }
                    }
                    else
                    {
                        var mouths = [
                            'full',
                            'happy',
                            'sad'
                        ];
                        var mouth = mouths[r5.integer(0, (mouths.length - 1))];
                        
                        if(mouth == 'full')
                        {

                            var w = mw - (mw/4);
                            var lx = mx + vym;
                            var ly = (my + vxm) - (mw/4);

                            if(bac.teeth)
                            {
                                circle((mx + vym) - 10, ((my + vxm) - (mw/4)) - 10, (mw - (mw/4)) + 20, 2, mfill, mstroke, mline);

                                circle(mx + vym, (my + vxm) - (mw/4), mw - (mw/4), 2, mfill, mstroke, mline);

                                ctx.moveTo(
                                    lx + (w/2), 
                                    ly
                                );
                                ctx.lineTo(lx + (w/2), ly + w);
                                ctx.stroke();

                                ctx.moveTo(
                                    lx, 
                                    ly + (w/2)
                                );
                                ctx.lineTo(lx + w, ly + (w/2));
                                ctx.lineWidth = mline;
                                ctx.strokeStyle = colors[3];
                                ctx.stroke();
                            }
                            else
                            {   
                                circle(mx + vym, (my + vxm) - (mw/4), mw - (mw/4), 2, mfill, mstroke, mline);
                            }


                            ctx.strokeStyle = mstroke;
                            ctx.lineWidth = mline;
                        }
                        else if(mouth == 'happy')
                        {
                            circle((mx + vym) - (mw/2), ((my + vxm) - (mw/2)) - ((mw/2)+ma), mw * 2, 1, mfill, mstroke, mline);
                        }
                        else if(mouth == 'sad')
                        {
                            circle((mx + vym) - (mw/2), ((my + vxm) + (mw/2)) - ((mw/2)+ma), mw * 2, 1, mfill, mstroke, mline, true);
                        }
                        if(mouth == 'happy' || mouth == 'sad')
                        {
                            if(bac.teeth)
                            {
                                var ty1 = -20 + r1.integer(0, 30);
                                var ty2 = -20 + r2.integer(0, 30);
                                var y1 = (((my + vxm) - (mw/2)) - ((mw/2)+ma)) + mw;
                                var ex1 = mw / 2;
                                if(mouth == 'sad')
                                {
                                    if(ty1 < 0)
                                    {
                                        y1 = (y1 + ex1) - ty1;
                                    }
                                    else
                                    {
                                        y1 = (y1 + ex1) + ty1;
                                    }
                                }
                                ctx.globalAlpha = parseFloat('0.' + r5.integer(22, 77));
                                square(
                                    ((((mx + vym) - (mw/2)) + mw) - (mw/8)) - (mw / 6),
                                    y1,
                                    mw / 4,
                                    (mw / 2) + ty1,
                                    white,
                                    false,
                                    false
                                );
                                square(
                                    ((((mx + vym) - (mw/2)) + mw) - (mw/8)) + (mw / 6),
                                    y1,
                                    mw / 4,
                                    (mw / 2) + ty1,
                                    white,
                                    false,
                                    false
                                );
                                if(mouth == 'sad')
                                {
                                    if(ty2 < 0)
                                    {
                                        y1 = y1 - ty2;
                                    }
                                    else
                                    {
                                        y1 = y1 + ty2;
                                    }
                                }
                                if(r5.integer(22, 77) > 55)
                                {
                                    console.log('4 teeth?');
                                    square(
                                        ((((mx + vym) - (mw/2)) + mw) - (mw/8)) - (mw / 2),
                                        y1,
                                        mw / 4,
                                        (mw / 2) + ty2,
                                        white,
                                        false,
                                        false
                                    );
                                    square(
                                        ((((mx + vym) - (mw/2)) + mw) - (mw/8)) + (mw / 2),
                                        y1,
                                        mw / 4,
                                        (mw / 2) + ty2,
                                        white,
                                        false,
                                        false
                                    );
                                }
                                ctx.globalAlpha = a1;
                            }
                        }
                        mouth_location = (my + vxm) - (mw/2);
                    }
                }
                
                // Nose
                if(layer == 'nose')
                {
                    var space = mouth_location - nose_location;
                    console.log('space', space);

                    var nw = eh / r2.integer(2, 5);
                    console.log('space minus nw', (space - nw));
                    
                    var exx = (space - nw);
                    var added  = 0;
                    if(space > 30 && exx > nw) added+= exx/3;
                    else 
                    {
                        if(exx < nw && space > 30)
                        {
                            space = 0;
                        }
                        if(exx < 0)
                        {
                            added+= exx/3;
                        }
                        else
                        {
                            added-= exx/3;
                        }
                    }
                    
                    nose_location+= added;
                    console.log('added', added);
                    
                    if(space > 30)
                    {
                        ctx.globalAlpha = a5;
                        var nfill = colors[4];
                        var nx = ((can.width/2)/2) - (nw/2);
                        if(bac.gnose)
                        {
                            var x4 = r4.integer(1, 4);
                            var c5 = colors[r5.integer(0, colors.length - 1)];
                            nfill = grad(nx, nose_location - (ma/2), nw, nw, x4, colors[4], c5);
                        }
                        if(bac.nose == 'square')
                        {
                            square(nx - (nw/3), nose_location - (ma/2), nw/3, nw / 1.5, nfill, nstroke, nline);
                            square(nx + (nw/3), nose_location - (ma/2), nw/3, nw / 1.5, nfill, nstroke, nline);
                        }
                        else
                        {
                            circle(nx, nose_location - (ma/2), nw, 2, nfill, nstroke, nline);

                            var xw = nw / r2.integer(3, 10);
                            var xn = ((can.width/2)/2) - (xw/2);
                            var yn = (nose_location - (ma/2)) + (nw/2);
                            var yv = -5 + r3.integer(0, 10);

                            ctx.globalAlpha = 1;
                            circle(xn - xw, yn + yv, xw, 2, white);
                            circle(xn + xw, yn + yv, xw, 2, white);
                            ctx.globalAlpha = a5;
                        }
                    }
                }
            }
            
            avatar();
        }
        
        build_avatar(
            head_nft,
            leye_nft,
            reye_nft,
            mouth_nft,
            nose_nft
        );
            
        // Convert canvas to PNG
        var w = document.querySelector('#pandora-wrapper-' + nft);
        img = new Image();
        img.onload = function () 
        {
            var el = document.querySelector('#pandora-square-' + nft);
            w.removeChild(el);
        }
        img.src = can.toDataURL();
        w.appendChild(img);
            
        </script>
    </body>
</html>